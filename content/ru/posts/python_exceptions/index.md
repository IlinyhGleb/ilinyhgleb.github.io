+++
date = '2025-07-01T13:59:36+05:00'
draft = true
title = 'Исключения'
math = true
tags = ["Python", "Информатика", "Основы программирования"]
categories = ['Основы программирования']
courses = ['Основы программирования']
weight = 9
+++

<!--more-->

## Основные определения

>**Состояние программы** - содержание всех областей памяти, занятых переменными программы в один конкретный момент времени.

>**Программная ошибка (Баг)** - ошибка при работе программы, приводящая к неверным или неожидаемым результатам.

>**Отладка** - этап разработки компьютерной программы, на котором обнаруживают, локализуют и устраняют ошибки.

## Состояние программы

Рассмотрим простую программу:
```python
a=1
x=-6
x=abs(x)
b=0
b+=1
```

Проследим, как меняется состояние программы при выполнении операций:
```goat
+-------------+          +-------------+          +-------------+
| Состояние 0 |          | Состояние 2 |          | Состояние 3 |
+-------------+   a=1    +-------------+   x=-6   +-------------+
|             +--------->+ a=1         +--------->+ a=1         |
|             |          |             |          | x=-6        |
|             |          |             |          |             | 
+-------------+          +-------------+          +------+------+
                                                         |
                                                         |
                                                         | x=abs(x)
                                                         |
                                                         v
+-------------+          +-------------+          +-------------+
| Состояние 6 |          | Состояние 5 |          | Состояние 4 |
+-------------+   b+=1   +-------------+   b=0    +-------------+
| a=1         +--------->+ a=1         +--------->+ a=1         |
| x=6         |          | x=6         |          | x=6         |
| b=1         |          | b=0         |          |             | 
+-------------+          +-------------+          +-------------+
```

При поиске ошибок в коде, важно отслеживать изменение состояния программы, чтобы точно знать, в какой момент фактическое состояние программы стало отличаться от ожидаемого.

## Программные ошибки

### Типы программных ошибок

1. **Синтаксические ошибки** - ошибки в написании кода (неправильные названия, операторы, символы и т.д.). Как правило, на них указывает транслятор или среда разработки.
2. **Логические ошибки** - ошибки в алгоритмах, приводящие к неправильным результатам вычисления. Для проверки требуется сравнение результатов программы с известными результатами.
3. **Опечатки** - могут не нарушать синтаксис и логику алгоритма, но приводить к ошибочным результатам работы. Проверяются с помощью тестирования и проверки программ.

### Анализ программы на ошибки

1. **Статический анализ** - просмотр кода на наличие ошибок без запуска программы. Может быть выполняться вручную или с помощью специальных инструментов, в том числе встроенных в интегрированную среду разработки.
2. **Динамический анализ** - проверка работоспособности программы в процессе её работы.

### Технологии динамического анализа

>**Первоочерёдная цель анализа** - локализовать ошибку, т.е. найти конкретную строчку кода, которая приводит к ошибке

1. **Вывод текущего состояния программы** с помощью расположенных в критических точках программы операторов вывода (`print`) — в консоль, на экран (графическое отображение) или в файл. Вывод отладочных сведений в файл называется журналированием (логирование, написание лога - журнала).
2. **Использование отладчиков** — программных инструментов, позволяющих программисту наблюдать за пошаговым выполнением программы, останавливать и перезапускать её, прогонять в замедленном темпе, изменять значения в памяти и т.д.

## Отладка программы

Существуют различные методы нахождения и исправления ошибок. Рассмотрим различные методы, от простых до более сложных.

### Комментирование и GOTO

#### Простые методы отладки
В случае, если в программной среде нет отладчика, при этом программа достаточно тяжелая (требует много вычислительных/временных ресурсов) для полного её запуска в рамках отладки, перед запуском ограничивают код, который будет выполняться.

- **Комментирование** - превращение части кода в комментарии для того, чтобы интепретатор/компилятор проигнорировал её.
- **Использование меток GOTO** - добавление в код специальных команд типа **GOTO**, при исполнении которых интерпретатор перескакивает к определённому месту (метке) в коде исключая выполнение строк кода между командой и меткой.

Рассмотрим пример.
Ниже представлен код с ошибкой вычисления

```python
def f(x):
    return (q1 - 1)*x**2 + (p1 - 1)*x - m*j
DOTS_NUMBER = 10
a = float(input("введи a: "))
b = float(input("введи b: "))
c = float(input("введи c: "))
p = a * (tan(c) + 5)
q = (1 + (c**2)/2 + (b**2)/4)**0.
m = p
for i in range(10):
    m += a**q + ((p*a)**(1/3))/(q*a + p)
q += m
j = (sin(a) + cos(a))/(cos(a) - sin(a))*tan(a)
p1 = p * j
q1 = q * j
x_vector = [a + b*number for number in range(DOTS_NUMBER)]
y_vector = [f(x) for x in x_vector]
plt.plot(x_vector, y_vector)
plt.grid()
plt.show()
```

Однако, мы не можем сразу найти ошибку. В таком случае закомментируем часть команд и добавим `print` для оценки состояния:

```python
def f(x):
    return (q1 - 1)*x**2 + (p1 - 1)*x - m*j
DOTS_NUMBER = 10
a = float(input("введи a: "))
b = float(input("введи b: "))
c = float(input("введи c: "))
p = a * (tan(c) + 5)
q = (1 + (c**2)/2 + (b**2)/4)**0.
m = p
for i in range(10):
    m += a**q + ((p*a)**(1/3))/(q*a + p)
q += m
print(p, q, m)
#j = (sin(a) + cos(a))/(cos(a) - sin(a))*tan(a)
#p1 = p * j
#q1 = q * j
#x_vector = [a + b*number for number in range(DOTS_NUMBER)]
#y_vector = [f(x) for x in x_vector]
#plt.plot(x_vector, y_vector)
#plt.grid()
#plt.show()
```







### Использование отладчиков. Режим отладчика

- **Отладчик** — программный инструмент, позволяющий программисту наблюдать за выполнением исследуемой программы, останавливать и перезапускать её, прогонять в замедленном темпе, изменять значения в памяти и т.д.


### Исключения (Exceptions)

- **Исключения** - объекты, возвращаемые программой (функцией, методом) при возникновении ошибки. Состоят из
  1. Названия (тип ошибки). Например, **a/0** вернёт ZeroDivisionError - Деление на ноль, **3 + "4"** вернёт TypeError - неправильная работа с типами данных.
  2. Сообщение (текст ошибки). Например, "division by zero" и "can only concatenate str (not "int") to str" для двух примеров выше соответственно.
- В работу с исключениями входят:
  1. Создание исключений (В python можно вызвать командой **raise**)
  2. Обработка исключений
- Документация: <https://docs.python.org/3/tutorial/errors.html>

### Встроенные исключения

- BaseException - базовое исключение, порождающее все остальные
- SystemExit - системное исключение, порождаемое функцией sys.exit при выходе из программы
- KeyboardInterrupt - системное исключение, порождаемое пользовательским выходом из программы с помощью сочетания клавиш
- ArithmeticError - арифметическая ошибка
- AssertionError - выражение assert ложно
- ImportError - ошибка импорта модуля или его атрибута
- IndexError - индекс не входит в диапазон элементов
- NameError - не найдено переменных с таким именем
- SyntaxError - ошибка синтаксиса
- TypeError - операция к объекту несоответствующего типа

### Создание исключений. Пример

**Посчитать формулу**  
$$f(x)=\frac{\sqrt{x}}{x-5}$$

```python
def f(x):
    return x**0.5/(x-5)
```

1. **x=5** приводит к делению на ноль
2. **x<0** приводит к корню из отрицательного числа (результат: комплексное число)

### Обработка исключений. Конструкция try...except

- Использование условий **if** допустимо в случае, когда точно известны сценарии работы функции для любых исключений и при этом вероятность их появления существенна (50% и более). В этом подходе вначале проверяются исключения, после чего выполняется основной код.
- В общем случае используется конструкция **try...except**. При этом вначале будет произведена попытка выполнения основного кода. Если же возникнут ошибки (исключения), то будет произведена их обработка. Этот подход удобен, если выполение основного кода не связано с ресурсозатратными операциями и вероятность появления исключений мала.
- Допускается комбинация **if** и **try...except**.
- * try (англ.) - попробовать, except (англ.) - исключая, за исключением.

### Создание и обработка исключений. Пример. Вариант 5

```python
def f(x):
    try:
        if x < 0:
            raise NegativeSquareRoot
        return x**0.5/(x-5)
    except NegativeSquareRoot:
        raise NegativeSquareRoot('отрицательное число...')
    except ZeroDivisionError:
        raise ZeroDivisionError('деление на ноль')
    except Exception:
        raise Exception('Неизвестная ошибка')

while True:
    try:
        y = int(input('Введите число: '))
        print("Значение функции равно {:.4f}".format(f(y)))
        break
    except Exception:
        print('Неверное число, повторите ввод')
```
